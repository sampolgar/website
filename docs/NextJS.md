#

## ToDo

- [ ] https://nextjs.org/learn/basics/data-fetching

## serving images

- images served from public directory
- use the `import Image from 'next/image'` instead of classic HTML img tag
- faster page load (images are loazy-loaded i.e. only when in viewport), auto-resize, auto-format, responsive, even for external images

## serving pages

### Script

- loads scripts with `import Script from 'next/script'`
- use by `<Script src... strategy... onLoad... />`

### Head

- change `<head>` to `<Head>` and `import Head from 'next/head'`
- head changes the page name in the browser tab

## Layout

- Components can be shared across all pages. create the components directory at the root of the project and create a Layout.js file
- `import Layout from '../components/Layout'`
- layouts need `/layout.module.css` format

### CSS

- import global css to the page/\_app.js
- server needs restarting after global css changes

# architecture

## page generation

### Static or Server-side

- Nextjs supports both in the same app
- choose static if you can render a page at build time
- choose server-side if you need to fetch data at request time e.g. page updates based on user interaction
- you can also use javascript in the browser to render a page e.g. frequently updated data like a dashboard

### implementing static or server-side

####

## how to implement

# blog with nextjs

use YAML Front Matter to add metadata to markdown files

- npm install gray-matter
- https://github.com/jonschlinkert/gray-matter
  e.g.

```
---
title: 'When to Use Static Generation v.s. Server-side Rendering'
date: '2020-01-02'
---
```

## staticaly generating pages

- use dynamic routes to generate pages from markdown files
- first create a file `[id].js` in the pages directory
- then create a file to render all the posts with `getStaticProps` and `getStaticPaths`
- `getStaticProps` fetches the data for a single post
- `getStaticPaths` tells Nextjs how many pages there are

### getstaticpaths

- `getStaticPaths` runs at serverside and called at build time
- this means that the paths returned from `getStaticPaths` will be rendered to HTML at build time
- getstaticpaths can't call an API endpoint
- they can be used to make DB queries which won't be sent to the browser (to keep safe)

### getstaticprops

- `getStaticProps` runs at serverside and called at build time
- this means that the props returned from `getStaticProps` will be passed to the page component at build time
- getstaticprops can't call an API endpoint
- they can be used to make DB queries which won't be sent to the browser (to keep safe)

## nextjs gitignore

```
# Logs
logs
*.log
npm-debug.log*

# Runtime data
pids
*.pid
*.seed

# Directory for instrumented libs generated by jscoverage/JSCover
lib-cov

# Coverage directory used by tools like istanbul
coverage

# nyc test coverage
.nyc_output

# Grunt intermediate storage (http://gruntjs.com/creating-plugins#storing-task-files)
.grunt

# node-waf configuration
.lock-wscript

# Compiled binary addons (http://nodejs.org/api/addons.html)
build/Release

# Dependency directories
node_modules
jspm_packages

# Optional npm cache directory
.npm

# Optional REPL history
.node_repl_history
.next
```

# NextJS TypeScript

- https://nextjs.org/docs/basic-features/typescript

# .env files
`.env.local`
Environment variables must be referenced as e.g. process.env.PUBLISHABLE_KEY, not const { PUBLISHABLE_KEY } = process.env.
```
# .env
A=abc

# becomes "preabc"
WRONG=pre$A

# becomes "pre$A"
CORRECT=pre\$A 
```